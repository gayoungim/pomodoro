<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ… ë½€ëª¨ë„ë¡œ íƒ€ì´ë¨¸</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { margin: 0; padding: 0; }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        
        function PomodoroApp() {
          const [minutes, setMinutes] = useState(25);
          const [seconds, setSeconds] = useState(0);
          const [isActive, setIsActive] = useState(false);
          const [mode, setMode] = useState('work');
          const [pomodorosCompleted, setPomodorosCompleted] = useState(0);
          const [todayPomodoros, setTodayPomodoros] = useState(0);
          const [showSettings, setShowSettings] = useState(false);
          const [showNotionSettings, setShowNotionSettings] = useState(false);
          const [startTime, setStartTime] = useState(null);
          
          const [workDuration, setWorkDuration] = useState(25);
          const [breakDuration, setBreakDuration] = useState(5);
          const [longBreakDuration, setLongBreakDuration] = useState(15);
          const [pomodorosUntilLongBreak, setPomodorosUntilLongBreak] = useState(4);
          
          const [notionToken, setNotionToken] = useState('');
          const [notionPageId, setNotionPageId] = useState('');
          const [notionConnected, setNotionConnected] = useState(false);

          const audioRef = useRef(null);

          // Load settings from localStorage
          useEffect(() => {
            const savedToken = localStorage.getItem('notionToken');
            const savedPageId = localStorage.getItem('notionPageId');
            if (savedToken && savedPageId) {
              setNotionToken(savedToken);
              setNotionPageId(savedPageId);
              setNotionConnected(true);
            }
          }, []);

          useEffect(() => {
            let interval = null;
            
            if (isActive) {
              interval = setInterval(() => {
                if (seconds === 0) {
                  if (minutes === 0) {
                    handleTimerComplete();
                  } else {
                    setMinutes(minutes - 1);
                    setSeconds(59);
                  }
                } else {
                  setSeconds(seconds - 1);
                }
              }, 1000);
            } else {
              clearInterval(interval);
            }
            
            return () => clearInterval(interval);
          }, [isActive, minutes, seconds]);

          const handleTimerComplete = () => {
            setIsActive(false);
            playSound();
            
            if (mode === 'work') {
              const newCount = pomodorosCompleted + 1;
              const endTime = new Date();
              setPomodorosCompleted(newCount);
              setTodayPomodoros(todayPomodoros + 1);
              
              if (notionConnected && startTime) {
                sendToNotion(startTime, endTime, newCount);
              }
              
              if (newCount % pomodorosUntilLongBreak === 0) {
                setMode('longBreak');
                setMinutes(longBreakDuration);
              } else {
                setMode('break');
                setMinutes(breakDuration);
              }
            } else {
              setMode('work');
              setMinutes(workDuration);
            }
            setSeconds(0);
            setStartTime(null);
          };

          const playSound = () => {
            if (audioRef.current) {
              audioRef.current.play();
            }
          };

          const toggleTimer = () => {
            if (!isActive && mode === 'work' && !startTime) {
              setStartTime(new Date());
            }
            setIsActive(!isActive);
          };

          const resetTimer = () => {
            setIsActive(false);
            setSeconds(0);
            setStartTime(null);
            if (mode === 'work') {
              setMinutes(workDuration);
            } else if (mode === 'break') {
              setMinutes(breakDuration);
            } else {
              setMinutes(longBreakDuration);
            }
          };

          const switchMode = (newMode) => {
            setIsActive(false);
            setMode(newMode);
            setSeconds(0);
            setStartTime(null);
            if (newMode === 'work') {
              setMinutes(workDuration);
            } else if (newMode === 'break') {
              setMinutes(breakDuration);
            } else {
              setMinutes(longBreakDuration);
            }
          };

          const formatTime24 = (date) => {
            const hours = String(date.getHours()).padStart(2, '0');
            const mins = String(date.getMinutes()).padStart(2, '0');
            return `${hours}:${mins}`;
          };

          const sendToNotion = async (start, end, count) => {
            if (!notionToken || !notionPageId) return;
            
            try {
              const startTimeStr = formatTime24(start);
              const endTimeStr = formatTime24(end);
              const logMessage = `ğŸ… ${startTimeStr} ~ ${endTimeStr} | ë½€ëª¨ë„ë¡œ ${count} ì™„ë£Œ`;
              
              const response = await fetch(`https://api.notion.com/v1/blocks/${notionPageId}/children`, {
                method: 'PATCH',
                headers: {
                  'Authorization': `Bearer ${notionToken}`,
                  'Content-Type': 'application/json',
                  'Notion-Version': '2022-06-28'
                },
                body: JSON.stringify({
                  children: [
                    {
                      object: 'block',
                      type: 'paragraph',
                      paragraph: {
                        rich_text: [
                          {
                            type: 'text',
                            text: {
                              content: logMessage
                            }
                          }
                        ]
                      }
                    }
                  ]
                })
              });
              
              if (response.ok) {
                console.log('âœ… ë…¸ì…˜ì— ê¸°ë¡ë¨:', logMessage);
              } else {
                const error = await response.json();
                console.error('ë…¸ì…˜ API ì˜¤ë¥˜:', error);
                alert('ë…¸ì…˜ ì—°ë™ ì‹¤íŒ¨: ' + (error.message || 'ê¶Œí•œì„ í™•ì¸í•´ì£¼ì„¸ìš”'));
              }
            } catch (error) {
              console.error('ë…¸ì…˜ ì—°ë™ ì˜¤ë¥˜:', error);
              alert('ë…¸ì…˜ ì—°ë™ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤');
            }
          };

          const saveSettings = () => {
            setShowSettings(false);
            if (mode === 'work') setMinutes(workDuration);
            else if (mode === 'break') setMinutes(breakDuration);
            else setMinutes(longBreakDuration);
            setSeconds(0);
            setIsActive(false);
            setStartTime(null);
          };

          const saveNotionSettings = () => {
            const connected = !!notionToken && !!notionPageId;
            setNotionConnected(connected);
            
            if (connected) {
              localStorage.setItem('notionToken', notionToken);
              localStorage.setItem('notionPageId', notionPageId);
            } else {
              localStorage.removeItem('notionToken');
              localStorage.removeItem('notionPageId');
            }
            
            setShowNotionSettings(false);
          };

          const formatTime = (mins, secs) => {
            return `${String(mins).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;
          };

          return (
            <div className="min-h-screen bg-gradient-to-br from-rose-50 to-orange-50 p-4 sm:p-8">
              <audio ref={audioRef} src="data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBSuBzvLZiTcIGWi77eafTRAMUKfj8LZjHAY4ktfyzHksBSR3x/DdkEAKFF606+uoVRQKRp/g8r5sIQUrgc7y2Yk3CBlou+3mn00QDFCn4/C2YxwGOJLX8sx5LAUkd8fw3ZBACg==" />
              
              <div className="max-w-md mx-auto">
                <div className="flex justify-between items-center mb-6">
                  <h1 className="text-2xl sm:text-3xl font-bold text-gray-800">ğŸ… ë½€ëª¨ë„ë¡œ</h1>
                  <div className="flex gap-2">
                    <button
                      onClick={() => setShowNotionSettings(true)}
                      className={`p-2 rounded-lg ${notionConnected ? 'bg-green-100 text-green-600' : 'bg-gray-100 text-gray-600'} hover:bg-opacity-80 transition text-sm sm:text-base`}
                      title="ë…¸ì…˜ ì—°ë™"
                    >
                      {notionConnected ? 'âœ“ ì—°ë™ë¨' : 'ë…¸ì…˜'}
                    </button>
                    <button
                      onClick={() => setShowSettings(true)}
                      className="p-2 rounded-lg bg-gray-100 text-gray-600 hover:bg-gray-200 transition"
                    >
                      âš™
                    </button>
                  </div>
                </div>

                <div className="flex gap-2 mb-4">
                  <button
                    onClick={() => switchMode('work')}
                    className={`flex-1 py-2 px-2 sm:px-4 rounded-lg font-medium transition text-sm sm:text-base ${
                      mode === 'work' ? 'bg-rose-500 text-white' : 'bg-white text-gray-600'
                    }`}
                  >
                    ì§‘ì¤‘
                  </button>
                  <button
                    onClick={() => switchMode('break')}
                    className={`flex-1 py-2 px-2 sm:px-4 rounded-lg font-medium transition text-sm sm:text-base ${
                      mode === 'break' ? 'bg-green-500 text-white' : 'bg-white text-gray-600'
                    }`}
                  >
                    íœ´ì‹
                  </button>
                  <button
                    onClick={() => switchMode('longBreak')}
                    className={`flex-1 py-2 px-2 sm:px-4 rounded-lg font-medium transition text-sm sm:text-base ${
                      mode === 'longBreak' ? 'bg-blue-500 text-white' : 'bg-white text-gray-600'
                    }`}
                  >
                    ê¸´ íœ´ì‹
                  </button>
                </div>

                <div className="bg-white rounded-3xl shadow-xl p-6 sm:p-12 mb-4">
                  <div className="text-center">
                    <div className="text-5xl sm:text-7xl font-bold text-gray-800 mb-6 sm:mb-8 font-mono">
                      {formatTime(minutes, seconds)}
                    </div>
                    
                    <div className="flex justify-center gap-3 sm:gap-4">
                      <button
                        onClick={toggleTimer}
                        className={`p-3 sm:p-4 rounded-full ${
                          mode === 'work' ? 'bg-rose-500' : mode === 'break' ? 'bg-green-500' : 'bg-blue-500'
                        } text-white hover:opacity-90 transition shadow-lg text-xl sm:text-2xl`}
                      >
                        {isActive ? 'âšâš' : 'â–¶'}
                      </button>
                      <button
                        onClick={resetTimer}
                        className="p-3 sm:p-4 rounded-full bg-gray-200 text-gray-700 hover:bg-gray-300 transition text-xl sm:text-2xl"
                      >
                        â†»
                      </button>
                    </div>
                  </div>
                </div>

                <div className="bg-white rounded-2xl shadow-lg p-4 sm:p-6">
                  <div className="flex justify-around">
                    <div className="text-center">
                      <div className="text-2xl sm:text-3xl font-bold text-rose-500">{todayPomodoros}</div>
                      <div className="text-xs sm:text-sm text-gray-600 mt-1">ì˜¤ëŠ˜ ì™„ë£Œ</div>
                    </div>
                    <div className="text-center">
                      <div className="text-2xl sm:text-3xl font-bold text-orange-500">{pomodorosCompleted}</div>
                      <div className="text-xs sm:text-sm text-gray-600 mt-1">ì´ ì™„ë£Œ</div>
                    </div>
                    <div className="text-center">
                      <div className="text-2xl sm:text-3xl font-bold text-blue-500">
                        {pomodorosCompleted % pomodorosUntilLongBreak}
                      </div>
                      <div className="text-xs sm:text-sm text-gray-600 mt-1">ê¸´ íœ´ì‹ê¹Œì§€</div>
                    </div>
                  </div>
                </div>

                {showSettings && (
                  <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
                    <div className="bg-white rounded-2xl p-6 max-w-sm w-full">
                      <h2 className="text-2xl font-bold mb-4">ì„¤ì •</h2>
                      
                      <div className="space-y-4">
                        <div>
                          <label className="block text-sm font-medium text-gray-700 mb-1">
                            ì§‘ì¤‘ ì‹œê°„ (ë¶„)
                          </label>
                          <input
                            type="number"
                            value={workDuration}
                            onChange={(e) => setWorkDuration(Number(e.target.value))}
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg"
                            min="1"
                            max="60"
                          />
                        </div>
                        
                        <div>
                          <label className="block text-sm font-medium text-gray-700 mb-1">
                            íœ´ì‹ ì‹œê°„ (ë¶„)
                          </label>
                          <input
                            type="number"
                            value={breakDuration}
                            onChange={(e) => setBreakDuration(Number(e.target.value))}
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg"
                            min="1"
                            max="30"
                          />
                        </div>
                        
                        <div>
                          <label className="block text-sm font-medium text-gray-700 mb-1">
                            ê¸´ íœ´ì‹ ì‹œê°„ (ë¶„)
                          </label>
                          <input
                            type="number"
                            value={longBreakDuration}
                            onChange={(e) => setLongBreakDuration(Number(e.target.value))}
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg"
                            min="1"
                            max="60"
                          />
                        </div>
                        
                        <div>
                          <label className="block text-sm font-medium text-gray-700 mb-1">
                            ê¸´ íœ´ì‹ê¹Œì§€ ë½€ëª¨ë„ë¡œ ìˆ˜
                          </label>
                          <input
                            type="number"
                            value={pomodorosUntilLongBreak}
                            onChange={(e) => setPomodorosUntilLongBreak(Number(e.target.value))}
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg"
                            min="2"
                            max="10"
                          />
                        </div>
                      </div>
                      
                      <div className="flex gap-2 mt-6">
                        <button
                          onClick={() => setShowSettings(false)}
                          className="flex-1 px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition"
                        >
                          ì·¨ì†Œ
                        </button>
                        <button
                          onClick={saveSettings}
                          className="flex-1 px-4 py-2 bg-rose-500 text-white rounded-lg hover:bg-rose-600 transition"
                        >
                          ì €ì¥
                        </button>
                      </div>
                    </div>
                  </div>
                )}

                {showNotionSettings && (
                  <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
                    <div className="bg-white rounded-2xl p-6 max-w-sm w-full max-h-screen overflow-y-auto">
                      <h2 className="text-2xl font-bold mb-4">ë…¸ì…˜ ì—°ë™ ì„¤ì •</h2>
                      
                      <div className="space-y-4">
                        <div>
                          <label className="block text-sm font-medium text-gray-700 mb-1">
                            Notion Integration Token
                          </label>
                          <input
                            type="password"
                            value={notionToken}
                            onChange={(e) => setNotionToken(e.target.value)}
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm"
                            placeholder="secret_..."
                          />
                        </div>
                        
                        <div>
                          <label className="block text-sm font-medium text-gray-700 mb-1">
                            Page ID
                          </label>
                          <input
                            type="text"
                            value={notionPageId}
                            onChange={(e) => setNotionPageId(e.target.value)}
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm"
                            placeholder="32ìë¦¬ Page ID"
                          />
                        </div>
                        
                        <div className="text-xs text-gray-600 bg-blue-50 p-3 rounded-lg">
                          <p className="font-semibold mb-2 text-blue-800">ğŸ“ ì„¤ì • ë°©ë²•</p>
                          <ol className="list-decimal list-inside space-y-2">
                            <li><strong>Integration ë§Œë“¤ê¸°</strong>
                              <ul className="list-disc list-inside ml-4 mt-1">
                                <li><a href="https://www.notion.so/my-integrations" target="_blank" className="text-blue-600 underline">notion.so/my-integrations</a> ì ‘ì†</li>
                                <li>"New integration" í´ë¦­</li>
                                <li>ì´ë¦„ ì…ë ¥ í›„ ìƒì„±</li>
                                <li>"Internal Integration Token" ë³µì‚¬</li>
                              </ul>
                            </li>
                            <li className="mt-2"><strong>í˜ì´ì§€ ì—°ê²°</strong>
                              <ul className="list-disc list-inside ml-4 mt-1">
                                <li>ë°ì¼ë¦¬ ë©”ëª¨ í˜ì´ì§€ ì—´ê¸°</li>
                                <li>ìš°ì¸¡ ìƒë‹¨ "..." â†’ "Add connections"</li>
                                <li>ë§Œë“  Integration ì„ íƒ</li>
                              </ul>
                            </li>
                            <li className="mt-2"><strong>Page ID ë³µì‚¬</strong>
                              <ul className="list-disc list-inside ml-4 mt-1">
                                <li>í˜ì´ì§€ URL: notion.so/<span className="bg-yellow-200">xxxxxxxx...</span></li>
                                <li>ë§ˆì§€ë§‰ 32ìë¦¬ê°€ Page ID</li>
                              </ul>
                            </li>
                          </ol>
                        </div>

                        <div className="text-xs text-gray-600 bg-green-50 p-3 rounded-lg">
                          <p className="font-semibold mb-1 text-green-800">âœ¨ ê¸°ë¡ í˜•ì‹</p>
                          <p className="font-mono text-xs bg-white p-2 rounded mt-1">
                            ğŸ… 14:30 ~ 14:55 | ë½€ëª¨ë„ë¡œ 1 ì™„ë£Œ<br/>
                            ğŸ… 15:05 ~ 15:30 | ë½€ëª¨ë„ë¡œ 2 ì™„ë£Œ
                          </p>
                        </div>

                        <div className="text-xs text-gray-600 bg-orange-50 p-3 rounded-lg">
                          <p className="font-semibold mb-1 text-orange-800">ğŸ”’ ë…¸ì…˜ ì„ë² ë“œ ë°©ë²•</p>
                          <ol className="list-decimal list-inside space-y-1">
                            <li>ì´ HTML íŒŒì¼ì„ GitHub Pagesë‚˜ ì›¹ì„œë²„ì— ì—…ë¡œë“œ</li>
                            <li>ë…¸ì…˜ í˜ì´ì§€ì—ì„œ "/embed" ì…ë ¥</li>
                            <li>ì—…ë¡œë“œí•œ URL ì…ë ¥</li>
                          </ol>
                        </div>
                      </div>
                      
                      <div className="flex gap-2 mt-6">
                        <button
                          onClick={() => setShowNotionSettings(false)}
                          className="flex-1 px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition"
                        >
                          ì·¨ì†Œ
                        </button>
                        <button
                          onClick={saveNotionSettings}
                          className="flex-1 px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition"
                        >
                          ì €ì¥
                        </button>
                      </div>
                    </div>
                  </div>
                )}
              </div>
            </div>
          );
        }
        
        ReactDOM.render(<PomodoroApp />, document.getElementById('root'));
    </script>
</body>
</html>
